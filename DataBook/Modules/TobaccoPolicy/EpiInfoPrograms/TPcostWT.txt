ROUTEOUT 'C:\STEPS\EpiInfo\Output Tables\TPcostWT.htm' REPLACE
READ 'C:\STEPS\EpiInfo\STEPS.mdb':data1
RELATE data2 qr :: qr
WRITE REPLACE "Epi 2000" 'C:\STEPS\EpiInfo\STEPS.mdb':temp AgeRange Sex Valid T1 T2 T5a T5aw TP6 TP7 PSU Stratum WStep1

READ 'C:\STEPS\EpiInfo\STEPS.mdb':temp

Dialog "This program assumes a maximum of 7776 (error code of 7777) for the number of cigarettes purchased and the amount spent on this purchase. If your data uses more or less, please modify the program accordingly or ask the STEPS team for assistance."


DEFINE TP6CLN

IF (TP6>0 AND TP6<7777) THEN
TP6CLN=1
ELSE
TP6CLN=2
END

DEFINE TP7CLN

IF (TP7>0 AND TP7<7777) THEN
TP7CLN=1
ELSE
TP7CLN=2
END

WRITE REPLACE "Epi 2000" 'C:\STEPS\EpiInfo\STEPS.mdb':temp * 
READ 'C:\STEPS\EpiInfo\STEPS.mdb':temp

DEFINE priceper20cigs

priceper20cigs=(TP7/TP6)*20

DEFINE CLN

IF (T1=1 AND TP6CLN=1 AND TP7CLN=1 AND Valid=1) THEN
CLN=1
ELSE
CLN=2
END

WRITE REPLACE "Epi 2000" 'C:\STEPS\EpiInfo\STEPS.mdb':temp * 
READ 'C:\STEPS\EpiInfo\STEPS.mdb':temp

DEFINE cigCLN
cigCLN=CLN

IF T2=1 AND (T5a=(.) OR T5a>50) THEN
cigCLN=2
END

IF  T2=2 AND (T5aw=(.) OR T5aw>350) THEN
cigCLN=2
END

IF T5a>50 OR T5aw>350 THEN
cigCLN=2
END

DEFINE cigspermonth

IF T1=1 AND T5aw>0 AND T5aw<=350 THEN
cigspermonth=t5aw*4
END

IF T2=1 AND T5a>0 AND T5a<=50 THEN
cigspermonth=T5a*30
END

DEFINE monthlyexp
monthlyexp=cigspermonth*(TP7/TP6)

WRITE REPLACE "Epi 2000" 'C:\STEPS\EpiInfo\STEPS.mdb':temp * 
READ 'C:\STEPS\EpiInfo\STEPS.mdb':temp
 
HEADER 2 "Mean price for 20 cigs"
HEADER 4 "Program: TPcostWT"

SELECT CLN=1
SELECT Sex="Men"
HEADER 5 "Men"
MEANS priceper20cigs AgeRange STRATAVAR=Stratum WEIGHTVAR=Wstep1 PSUVAR=PSU
SELECT

SELECT CLN=1
SELECT Sex="Women"
HEADER 5 "Women"
MEANS priceper20cigs AgeRange STRATAVAR=Stratum WEIGHTVAR=Wstep1 PSUVAR=PSU
SELECT

SELECT CLN=1
HEADER 5 "Both Sexes"
MEANS priceper20cigs AgeRange STRATAVAR=Stratum WEIGHTVAR=Wstep1 PSUVAR=PSU
SELECT

SELECT cigCLN=1
SELECT Sex="Men"
HEADER 5 "Men"
MEANS monthlyexp AgeRange STRATAVAR=Stratum WEIGHTVAR=Wstep1 PSUVAR=PSU
SELECT

SELECT cigCLN=1
SELECT Sex="Women"
HEADER 5 "Women"
MEANS monthlyexp AgeRange STRATAVAR=Stratum WEIGHTVAR=Wstep1 PSUVAR=PSU
SELECT

SELECT cigCLN=1
HEADER 5 "Both Sexes"
MEANS monthlyexp AgeRange STRATAVAR=Stratum WEIGHTVAR=Wstep1 PSUVAR=PSU
SELECT


HEADER 1 RESET
HEADER 2 RESET
HEADER 3 RESET
HEADER 4 RESET
HEADER 5 RESET
